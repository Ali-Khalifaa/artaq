import{_ as y,a as k,d as b,j as f,b as _,i as v}from"./jquery-Bk-ga-hZ.js";const x={name:"share_booking_google_map_component",data(){return{markers:[],map:null,directions:null,driverCar:null,apiKey:void 0}},mounted(){this.booking&&(this.initAutocomplete(),window.Echo.channel(`track-user-booking.${this.booking.booking_id}.${this.booking.booking_no}`).listen(".move",e=>{this.driverCar.setLngLat([e.lng,e.lat]),this.addCircleLayer(this.map,[e.lat,e.lng])}))},props:["booking"],methods:{initAutocomplete(){var i,r;let e=(r=(i=this.booking)==null?void 0:i.from_location)==null?void 0:r.replace(" ","").split(",").map(parseFloat),o=new Date().getHours(),n=o<6||o>=18?"mapbox://styles/mapbox/navigation-night-v1":"mapbox://styles/mapbox/streets-v12";const t=new mapboxgl.Map({container:"share_booking",center:[parseFloat(e[1]),parseFloat(e[0])],zoom:10,style:n,language:"ar"});t.on("load",()=>{setTimeout(()=>{t.addControl(new mapboxgl.NavigationControl),t.setLayoutProperty("country-label","text-field",["get","name_ar"]),t.resize()},100),this.mapWithMarkersAndDriverMode(t,e)}),this.map=t},addMarker(e,o,n="/images/route.png"){const t=document.createElement("div");t.className="marker",t.style.backgroundImage=`url(${n})`,t.style.width="32px",t.style.height="32px",t.style.backgroundSize="cover";const i=new mapboxgl.Marker(t).setLngLat([e.lng,e.lat]).addTo(o);return this.markers.push(i),i},mapWithMarkersAndDriverMode(e,o){let n=o,t=this.booking.to_location[this.booking.to_location.length-1].replace(" ","").split(",").map(parseFloat),i=[];this.booking.to_location.forEach((r,l)=>{i.push(r.replace(" ","").split(",").map(parseFloat)),l<this.booking.to_location.length-1}),this.directions=new MapboxDirections({accessToken:mapboxgl.accessToken,unit:"metric",profile:"mapbox/driving",interactive:!1,language:"ar",controls:{inputs:!1,instructions:!1},styles:[{id:"directions-origin-point",type:"circle",source:"directions",paint:{"circle-radius":0,"circle-color":"transparent"},filter:["all",["in","$type","Point"],["in","marker-symbol","A"]]},{id:"directions-destination-point",type:"circle",source:"directions",paint:{"circle-radius":0,"circle-color":"transparent"},filter:["all",["in","$type","Point"],["in","marker-symbol","B"]]}]}),this.directions.setOrigin([n[1],n[0]]),this.directions.setDestination([t[1],t[0]]),i.length>0&&i.forEach(r=>{this.directions.addWaypoint(this.directions.getWaypoints().length,[r[1],r[0]])}),this.directions.on("route",r=>{var h;const l=r.route[0].geometry;let c=r.route[0].legs[r.route[0].legs.length-1].steps,p=c[c.length-1].maneuver.location;const d=r.route[0].legs;for(let a=0;a<=d.length-1;a++)d[a].steps.forEach((s,m)=>{if(console.log(s),d.length-1==a&&c.length-1==m){this.addMarker({lng:p[0],lat:p[1]},e,"/images/end.png");return}m==0&&(a==0?(this.addCircleLayer(e,[s.maneuver.location[1],s.maneuver.location[0]]),this.animateCircle(e,"circle-layer"),this.driverCar=this.addMarker({lng:s.maneuver.location[0],lat:s.maneuver.location[1]},e,"/images/car.png")):this.addMarker({lng:s.maneuver.location[0],lat:s.maneuver.location[1]},e,"/images/route.png"))});const u=new mapboxgl.LngLatBounds;(h=l.coordinates)==null||h.forEach(a=>u.extend(a)),e.fitBounds(u,{padding:20})}),e.addControl(this.directions,"top-left")},addCircleLayer(e,o){e.getLayer("circle-layer")&&e.removeLayer("circle-layer"),e.getSource("circle-layer")&&e.removeSource("circle-layer"),e.addLayer({id:"circle-layer",type:"circle",source:{type:"geojson",data:{type:"Feature",geometry:{type:"Point",coordinates:[o[1],o[0]]}}},paint:{"circle-radius":25,"circle-color":"#ff0000","circle-opacity":.5}})},animateCircle(e,o,n=!0){const t=e.getPaintProperty(o,"circle-radius"),i=n?t+1:t-1;i>50&&(n=!1),i<10&&(n=!0),e.setPaintProperty(o,"circle-radius",i),requestAnimationFrame(()=>this.animateCircle(e,o,n))}}},w={id:"share_booking",style:{width:"100%",height:"100%"}};function C(e,o,n,t,i,r){return k(),b("div",w)}const L=y(x,[["render",C]]);window.$=window.jQuery=f;const g=_({});g.component("share-booking-google-map-component",L);g.use(v);g.mount("#app");
